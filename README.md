Maintaining the Kwiat group website with Jekyll
==================

This guide was written by Rebecca Holmes. Contact me at rholmes@illinois.edu if you need help.

*NOTE: I built this website using Jekyll on Windows 7. Jekyll and most of the other tools needed to maintain the website are also available for Mac and Linux, but I don't have any experience using them on other platforms.*

Introduction
------------------

The Kwiat group website is maintained using Jekyll and files hosted on [GitHub](https://github.com/). This guide contains an overview of how Jekyll generates the site, and instructions for specific tasks like adding news posts or editing the navbar. It does not explain every detail of how Jekyll works, or every possible feature you might want to use. For more about what Jekyll can do, read the Jekyll documentation here: http://jekyllrb.com/docs/home/

###But first, wait! Don't edit those HTML files on the server!

Seriously, don't do it. All will be explained! But basically, the way this works is that if you want to change something on the website, you're going to do the following:

1. Edit a file in this GitHub repository
2. Run Jekyll
3. Copy the files generated by Jekyll to the server that hosts the website

If you edit the HTML files (or any files) that are already on the server, your changes will not be visible to Jekyll or committed to the GitHub repository, and they will be lost the next time someone runs Jekyll and updates the website.

And whatever you're trying to change, there's probably an easier way to do it using Jekyll. For example, you can edit most of the text on the website without ever looking at an HTML file. So resist the urge to edit that file, and read on.

###What is Jekyll?
Jekyll is a tool that takes pieces of content (like text files) and instructions for displaying them (like HTML layouts) and builds a website. It takes care of tedious things you might otherwise have to do manually, like updating the navbar on each page if you want to add a new link. Another common way to accomplish this is by building a dynamic site using PHP or other server-side languages. The advantages of using Jekyll are primarily that you don't need to learn a server-side language, and the site can be hosted anywhere without worrying about whether the host server supports your dynamic content.

The whole process of building the website happens on your computer, and the result is a static website that can be uploaded to a server. So while using Jekyll might seem intimidating, it's a great way to build a complex website without knowing much more than basic HTML and CSS. Many tasks won't even require more than editing plain old text. You can do it!

Installation and Setup
------------------

You must complete a few steps before you can maintain the website with Jekyll from your own computer. 

###Clone this GitHub repository

The GitHub repository group-website-jekyll stores a "master" version of the files needed to generate the website. You can download ("clone") these files to your own computer and use them. If you make changes, you can tell GitHub to sync them to the master version so there will be a single version of the files that multiple people can access.

1. If you don't already have one, you will need to make a [GitHub](https://github.com/) account. You will also need to contact one of the administrators of the lab GitHub group (KwiatQIM) and have your account added to the group.

2. Install and set up [GitHub Desktop for Windows](https://help.github.com/articles/set-up-git#platform-windows).

3. From GitHub Desktop, select the KwiatQIM group, find the repository group-website-jekyll, and click "Clone." This will copy the files from the repository to a folder on your computer.

The [GitHub help page](https://help.github.com/) can tell you more about using GitHub, but the basic idea is as follows:
* If someone else has made changes to the files in the group-website-jekyll repository, you can (and should) sync them to your local version by clicking "Sync" in the upper right-hand corner of GitHub Desktop. This will keep the copies of the website files on your computer up to date if several people are making changes.
* If *you* make a change to a file in the respository (edit some text, delete an unneeded file, etc.) you can (and should) save that change to the master version by "committing" the change from GitHub Desktop, which will automatically prompt you whenever it notices that files have changed. Finally, you should click "Sync" to upload your changes to the master version and finalize the change.

###Install Ruby and Jekyll

Jekyll is based on the programming language Ruby, which you must install in order to run Jekyll. (You don't need to know how to use Ruby.) Once Ruby is installed, you can easily install Jekyll and a few other necessary programs.

1. Install Ruby using [RubyInstaller](http://rubyinstaller.org/downloads/). Install the latest DevKit, available on the [RubyInstaller downloads page](http://rubyinstaller.org/downloads/).

2. After extracting the DevKit package, use the command prompt (type `cmd` in the Windows search bar) to `cd` to the directory where you extracted it. Run the following commands:

    ```
    ruby dk.rb init
    ruby dk.rb install
    ```

3. Install the RubyGem Jekyll by typing:

    ```
    gem install jekyll
    ```
    
4. Install the RubyGem RDiscount (a processor for Markdown, which we will use for simple text formatting):

    ```
    gem install rdiscount
    ```

###Install bibtex2html

bibtex2html is a program that converts BibTeX files to HTML so a list of references can be displayed on a webpage. Jekyll uses it to process the BibTeX file ```publications_web.bib``` in the ```_bibliography``` directory. If it is not installed or installed in the wrong location, Jekyll will give an error when you try to run it, and the list of publications will not be generated.

1. Install bibtex2html from the [bibtex2html home page](https://www.lri.fr/~filliatr/bibtex2html/). Use the Windows 1.95 installer. Put it in ```C:/Bibtex2html/bibtex2html.exe``` or Jekyll won't be able to use it. (This can be changed by editing ```bibjekyll.rb``` in the ```_plugins``` directory under the comment "call bibtex2html", but you will probably make someone else unhappy by changing it.)

###Optional: Install Mendeley

[Mendeley](http://www.mendeley.com/) is an academic reference manager. I use it to organize the citations that appear on the Publications page of the website. If you follow a few steps, you can use Mendeley, plus a simple Python script and Jekyll's interface with bibtex2html to maintain the list of citations, including automatically linking to the DOI and to a hosted .pdf file if one is available. Details are in the Publications section of this guide.

If you don't need to add, remove, or edit the content of citations, you don't need to install Mendeley or make any changes to ```publications_web.bib```. You can change certain formatting options (such as how the author names are abbreviated) in the ```style.bst``` file that bibtex2html uses.

Running Jekyll
------------------
If you've just copied the website files from GitHub to a new computer and you and haven't run Jekyll yet, the ```_site``` directory in your repository should be empty. When you run Jekyll, ```_site``` is where all the assembled pieces of the website will go--the finished product. GitHub will not sync the files in ```_site```. You can always generate them again by running Jekyll.

To run Jekyll and fill the empty ```_site``` directory with the assembled website, use the command prompt to ```cd``` to ```group-website-jekyll```. Then just enter the command

```
jekyll build
```

That's it! The ```_site``` directory should now be populated with the website files. The live website at http://research.physics.illinois.edu/QI/Photonics/ has not been updated, though.

###Updating the live website
After running Jekyll, just replace the contents of ```Photonics``` with the entire contents of ```_site```. You can do this in Windows Explorer if you have access to the networked folder where our webspace is, or you can use SSH. Contact help@physics.illinois.edu if you need help acccessing the webspace.

###Hosting the site locally

If you're testing out changes to the website, it can be useful to host it on your own computer so you can view it in a browser exactly as it will appear when it goes live. It can also be nice to set Jekyll to automatically rebuild the site when you make changes. To do this, you need to make a small change to the ```_config.yml``` file, and type an extra option when you run Jekyll. First, open ```_config.yml``` and change ```url``` to localhost:4000, like this:

```
#url: "http://research.physics.illinois.edu/QI/Photonics"
url: "http://localhost:4000"
```

Save the file. Now when you run Jekyll, use the ```server``` command with ```--watch```:

```
jekyll server --watch
```

This tells Jekyll to build the website, to host the contents of ```_site``` locally, and to automatically rebuild if you change anything. Now you should see the website if you point your browser to http://localhost:4000. (Reminder: what you see are still just files on your computer--you need to copy them to our webspace to make any changes live.) Change ```url``` back to the real URL of the website when you're ready to upload your changes, or all the links that use the ```{{ site.url }}``` variable will be broken.

A brief description of how Jekyll works
------------------

If you just want to know how to update a specific part of the website (like adding a news post), scroll down past this section to "How to do specific tasks." If you want an overview of what Jekyll is doing when you run it, read on.

Take a look at the list of files and folders in the group-website-jekyll repository. When you run Jekyll, it looks through all those files and folders, and follows certain rules to assemble the pieces they contain into a finished website in the ```_site``` directory. These are the main types of files and folders Jekyll looks at (for more details, see http://jekyllrb.com/docs/structure/):

1. Folders with no ```_``` (underscore) before their names. Jekyll just copies these directly to ```_site``` without changing anything. Example: ```img```, which contains all the images used on the website. ```css``` contains the CSS stylesheets for the website, which can be edited just like regular CSS. Files with no ```_``` and no YAML frontmatter (I'll explain what this is soon) will also be copied to ```_site``` verbatim.

2. HTML files with no ```_``` before their names, and which also contain YAML frontmatter. Example: ```people.html```, the page with information about the people in our group. Jekyll processes each of these to create an HTML file in ```_site```. With current settings, ```people.html``` ends up in ```_site/people/index.html```. (```index.html```, the home page of the website, just goes to ```_site``` with no subfolder.)

3. Folders with ```_``` before their names. These folders are not copied to ```_site``` directly, but contain content and information that Jekyll uses to assemble the website. Examples:
    * ```_layouts``` contains HTML files which define page layouts that can be reused for many pages. For example,       ```_layouts/default.html``` is a layout which puts a navbar at the top of the page and a footer at the bottom, and also includes some CSS and Javascript that is used on most pages in the website.
    * ```_includes``` contains pieces of content which can be inserted into pages with a special command. For example, ```{% include navbar.html %}``` will insert the code for a navbar wherever Jekyll finds it. ```{% markdown aboutus.md %}``` will process and insert the Markdown text in ```aboutus.md```, which appears under "About us" on the front page of the website. (More about Markdown later.)
    * ```_data``` contains YAML files with well-formatted data that Jekyll can use. For example, ```group_members.yml``` contains a list of current group members, their email addresses, and the filenames of headshot images. Jekyll uses it to generate the final People page.
    * ```_plugins``` contains Ruby scripts which give Jekyll extra features. For example, ```bibjekyll.rb``` handles the list of citations on the Publications page.
   
4. ```_config.yml``` is a special file which contains Jekyll's configuration information. You probably don't need to edit it unless you want to host the site locally (see Hosting the Site Locally, above).

###YAML frontmatter

YAML frontmatter is information contained between two lines of ```---``` at the start of a file, like this example from ```people.html```:

```
---
layout: default
title: People
---

<h1 style="text-align:center">Our group</h1>
<div class="people">

	{% include group-members.html %}

	<h1 class="category-title">Previous group members</h1>
	
	{% include previous-group-members.html %}
	
</div>
```

The YAML frontmatter gives Jekyll information and instructions when processing the file that contains it. The ```layout``` variable tells Jekyll which of the layouts in ```_layouts``` it should use for this page--in this example, the People page will use the default layout in ```_layouts/default.html```. The ```title``` variable tells Jekyll the title of the page. These variables can be accessed elsewhere on the website. For example, ```default.html``` automatically sets the title of each page to ```page.title```, and the navbar uses ```page.title``` to decide which page is the current page and highlight its link.

Jekyll will *only* process HTML documents in the main directory if they have YAML frontmatter. In other contexts, it is optional. Read more about YAML in the Jekyll documentation: http://jekyllrb.com/docs/frontmatter/.

###Markdown

Markdown is a text-to-HTML tool. It allows you to write good-looking content for the web without using HTML tags. Markdown files look more like regular text files, which makes them easier to read and work with. Markdown processes ```.md``` files to insert all the ugly HTML tags that make text display properly on the web.

Most of the text content for the group website is in Markdown files in the ```_includes``` directory.

* This is a useful Markdown cheat sheet: https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet

* And here's an online Markdown editor you can use in your browser: http://dillinger.io/

Markdown will also process many HTML tags, if you need to sneak some in there.

How to do specific tasks
------------------

Okay, you installed this stupid Jekyll thing and now you just want to be able to add a news post or delete a recently-graduated group member. This section will hopefully cover most common maintanence tasks.

###Adding a news post

Create a new file. Give it some YAML frontmatter (see the previous section) and add your content below, as in this example:

```
---
title: Students awarded NSF Graduate Research Fellowship and Goldwater Scholarship
layout: default
image: nsf1.gif
---

Second-year graduate student [Courtney Byard](http://physics.illinois.edu/news/story.asp?id=2470) received a 2013 Graduate Research Fellowship from the National Science Foundation. Rising senior undergraduate [David Schmid](http://physics.illinois.edu/news/story.asp?id=2417) received a 2013 Barry M. Goldwater Scholarship. Second-year graduate student Rebecca Holmes also received an NSF fellowship in 2012.
<!--more-->
```

```title``` should be the title of your news item, ```layout``` can stay "default," and ```image``` should be the filename of a small image you want to place next to your news item. Put the image in ```img```. The ```.newsbox img``` class in ```group.css``` currently resizes images to 75x75 px.

If your news post is longer than a few sentences, place the excerpt separator ```<!--more-->``` where you want the news post to break off on the home page of the website. Continue your text after the separator. In the YAML frontmatter, add the line

```
more: "yes"
```

This will tell Jekyll to add a "More" link at the end of your post excerpt on the main page, which will direct the reader to the full post on the News page.

Save your file in ```_posts``` as ```YEAR-MONTH-DAY-title.md```. For the example above, the filename should be ```2013-04-02-students-awarded-nsf-graduate-research-fellowships.md```. (Only the month and year will actually be displayed, although the day will be used to order posts.)

Run Jekyll, and your new post should appear on the main page and on the News page! Currently the main page is set to display only the three most recent news posts. If you want to change that limit, edit ```_includes/newsbox.html``` where it says ```{% for post in site.posts limit: 3 %}```.

###Changing information about group members

Jekyll generates the content of the People page using information from two files in the ```_data``` directory: ```group_members.yml``` and ```previous_group_members.yml```. These data files are processed in two HTML files, ```group-members.html``` and ```previous-group-members.html```, which are both included in ```people.html```. (You can see the include commands in the example in the "YAML frontmatter" subsection above.)

To add, remove, or change the information about a current group member, just edit his or her entry in ```group_members.yml```. For example, adding the following under the "Graduate Students" category...

```
- name: "Graduate Students"
  people:
    - name: "Smarty McSmartypants"
      image: "../img/headshot_blank.jpg"
      email: "smarty2@illinois.edu"
```

...will add a new person under the Graduate Students heading on the People page, complete with headshot and email address. Notice that different categories of people have different options--if you add an email address for a person in the "Undergraduate Students" category, it won't show up on the People page because ```group-members.html``` doesn't display email addresses for undergrads (unless you alter it so that it does!) The current settings also automatically organize graduate and undergraduate students in rows with three columns each. You can change this in ```group-members.html```.

That's basically it. Be sure to follow the existing YAML formatting exactly, because extra spaces or line breaks will cause errors. **Important: there must not be any tab characters in YAML files. Your text editor may add them automatically! Indentation is an important element of YAML syntax, and all the blank characters must be spaces, not tabs. Or things will break.**

Similarly, to add, remove or change the information about a past group member, edit his or her entry in ```previous_group_members.yml```, like so:

```
- name: "Graduate Students"
  people:
    - name: "Best grad student ever"
      year: "1957"
      thesis-type: "phd"
      thesis-file: "best-thesis.pdf"
      thesis-title: "Really Great Thesis"
      currently: "Retired"
      past: "Won a Nobel prize in every field"
```

Follow the existing examples. In the "Postdocs" and "Graduate Students" categories, most of the extra information (thesis, currently, past) is optional. Thesis files should go in the ```theses``` directory and have the filename specified.


###Managing research topics

###Adding a new page and editing the navbar

###Adding content (example: adding a video to the Fun page)

###Managing Publications